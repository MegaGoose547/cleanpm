<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Panel</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- Topbar reused from index -->
  <div class="topbar">
    <a href="index.html" class="topbar-button discord-button">‚Üê Back to Gallery</a>
    <h1 class="topbar-title">Admin Panel</h1>
    <div style="width: 140px;"></div> <!-- spacer -->
  </div>

  <div class="admin-container">
    <!-- üîê Login Form -->
    <div id="auth-section" class="admin-card">
      <h2>Login</h2>
      <form id="login-form">
        <input type="email" id="email" placeholder="Email" required>
        <input type="password" id="password" placeholder="Password" required>
        <button type="submit" class="random-button">Login</button>
        <p id="login-error" class="error-text"></p>
      </form>
    </div>

    <!-- ‚úÖ Admin Section -->
    <div id="admin-section" class="admin-card" style="display:none;">
      <h2>Add New Project</h2>
      <form id="project-form">
        <input type="file" id="image-file" accept="image/*" required>
        <input type="url" id="url" placeholder="Project URL" required>
        <input type="text" id="text" placeholder="Display Text">
        <button type="submit" class="random-button">Add Project</button>
      </form>
      <button id="logout-btn" class="sort-button" style="margin-top: 1rem;">Logout</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script>
    const supabase = window.supabase.createClient(
      'https://ubrsdotiwcmiyznvzhcw.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVicnNkb3Rpd2NtaXl6bnZ6aGN3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5ODEwMzksImV4cCI6MjA2OTU1NzAzOX0.n5p9dxhNv5u7GyvJ3e2xignsJDyOcBjsFWV6FCwxeVQ'
    );

    const authSection = document.getElementById('auth-section');
    const adminSection = document.getElementById('admin-section');
    const loginForm = document.getElementById('login-form');
    const projectForm = document.getElementById('project-form');
    const logoutBtn = document.getElementById('logout-btn');
    const loginError = document.getElementById('login-error');

    async function checkUser() {
      const { data: { user } } = await supabase.auth.getUser();
      if (user) {
        authSection.style.display = 'none';
        adminSection.style.display = 'block';
      } else {
        authSection.style.display = 'block';
        adminSection.style.display = 'none';
      }
    }

    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      const { error } = await supabase.auth.signInWithPassword({ email, password });

      if (error) {
        loginError.textContent = "Login failed: " + error.message;
      } else {
        loginError.textContent = "";
        await checkUser();
      }
    });

    logoutBtn.addEventListener('click', async () => {
      await supabase.auth.signOut();
      await checkUser();
    });

    projectForm.addEventListener('submit', async (e) => {
  e.preventDefault();

  const url = document.getElementById('url').value;
  const text = document.getElementById('text').value;
  const fileInput = document.getElementById('image-file');
  const file = fileInput.files[0];

  if (!file) {
    alert('Please select an image.');
    return;
  }

  const filename = ${Date.now()}-${file.name}; // unique filename
  const { error: uploadError } = await supabase.storage
    .from('project-images')
    .upload(filename, file);

  if (uploadError) {
    alert('Image upload failed: ' + uploadError.message);
    return;
  }

  const imageUrl = https://ubrsdotiwcmiyznvzhcw.supabase.co/storage/v1/object/public/project-images/${filename};

  const { error: insertError } = await supabase.from('projects').insert([
    { filename, url, text }
  ]);

  if (insertError) {
    alert('Project insert failed: ' + insertError.message);
    return;
  }

  alert('Project added successfully!');
  projectForm.reset();
});

    checkUser();
  </script>
</body>
</html>
